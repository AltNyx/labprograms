--TABLES
CREATE TABLE EMPLOYEE(
SSN INT,
NAME VARCHAR(20),
ADDRESS VARCHAR(30),
SEX VARCHAR(10),
SALARY INT,
SUPERSSN INT,
DNO INT,
PRIMARY KEY(SSN),
FOREIGN KEY(SUPERSSN) REFERENCES EMPLOYEE(SSN) ON DELETE CASCADE);

CREATE TABLE DEPARTMENT(
DNO INT,
DNAME VARCHAR(20),
MGRSSN INT,
MGRSTARTDATE DATE,
PRIMARY KEY(DNO),
FOREIGN KEY(MGRSSN) REFERENCES EMPLOYEE(SSN) ON DELETE CASCADE);

ALTER TABLE EMPLOYEE
ADD FOREIGN KEY(DNO)
REFERENCES DEPARTMENT(DNO);

CREATE TABLE DLOCATION(
DNO INT NOT NULL,
DLOC VARCHAR(30) NOT NULL,
PRIMARY KEY(DNO, DLOC),
FOREIGN KEY(DNO) REFERENCES DEPARTMENT(DNO) ON DELETE CASCADE);

CREATE TABLE PROJECT(
PNO INT PRIMARY KEY,
PNAME VARCHAR(30),
PLOCATION VARCHAR(30),
DNO INT,
FOREIGN KEY(DNO) REFERENCES DEPARTMENT(DNO) ON DELETE CASCADE);

CREATE TABLE WORKS_ON(
SSN INT,
PNO INT,
HOURS INT,
PRIMARY KEY(SSN, PNO),
FOREIGN KEY(SSN) REFERENCES EMPLOYEE(SSN) ON DELETE CASCADE,
FOREIGN KEY(PNO) REFERENCES PROJECT(PNO) ON DELETE CASCADE);


--INSERTING

INSERT INTO DEPARTMENT(DNO,DNAME) VALUES(1,"ACCOUNT");
INSERT INTO DEPARTMENT(DNO,DNAME) VALUES(2,"MANAGEMENT");
INSERT INTO DEPARTMENT(DNO,DNAME) VALUES(3,"MARKETING");
INSERT INTO DEPARTMENT(DNO,DNAME) VALUES(4,"SALES");
INSERT INTO DEPARTMENT(DNO,DNAME) VALUES(5,"IT");
INSERT INTO DEPARTMENT(DNO,DNAME) VALUES(6,"RESEARCH");


INSERT INTO EMPLOYEE (SSN, NAME, ADDRESS, SEX, SALARY, DNO)
VALUES ('23412356', 'JENNIFER', 'PARIS', 'FEMALE','700000', '4');
INSERT INTO EMPLOYEE (SSN, NAME, ADDRESS, SEX, SALARY, DNO)
VALUES ('23456781', 'JAMES', 'NEWYORK', 'MALE','300000', '4');
INSERT INTO EMPLOYEE (SSN, NAME, ADDRESS, SEX, SALARY, DNO)
VALUES ('33344555', 'FRANKLIN', 'CALIFORNIA','MALE', '600000', '5');
INSERT INTO EMPLOYEE (SSN, NAME, ADDRESS, SEX, SALARY, DNO)
VALUES ('67891234', 'JOYCE', 'WASHINGTON','FEMALE', '400000', '5');
INSERT INTO EMPLOYEE (SSN, NAME, ADDRESS, SEX, SALARY, DNO)
VALUES ('123456789', 'JOHN', 'TEXAS', 'MALE','300000', '5');
INSERT INTO EMPLOYEE (SSN, NAME, ADDRESS, SEX, SALARY, DNO)
VALUES ('888666555', 'AHMAD', 'CALIFORNIA','MALE', '700000', '4');
INSERT INTO EMPLOYEE (SSN, NAME, ADDRESS, SEX, SALARY, DNO)
VALUES ('984600445', 'MARK', 'WASHINGTON','MALE', '800000', '5');
INSERT INTO EMPLOYEE (SSN, NAME, ADDRESS, SEX, SALARY, DNO)
VALUES ('56789012', 'ALEENA', 'LONDON', 'FEMALE', '700000', '5');
INSERT INTO EMPLOYEE (SSN, NAME, ADDRESS, SEX, SALARY, DNO)
VALUES ('89012345', 'ALICE', 'STAFFORD', 'FEMALE', '1200000', '5');
INSERT INTO EMPLOYEE (SSN, NAME, ADDRESS, SEX, SALARY, DNO)
VALUES ('1111111', 'ALI', 'PARIS', 'MALE','700000', '1');

UPDATE EMPLOYEE SET SUPERSSN = '984600445' WHERE SSN = 23412356;
UPDATE EMPLOYEE SET SUPERSSN = '67891234' WHERE SSN = 23456781;
UPDATE EMPLOYEE SET SUPERSSN = '123456789' WHERE SSN = 33344555;
UPDATE EMPLOYEE SET SUPERSSN = '89012345' WHERE SSN = 56789012;
UPDATE EMPLOYEE SET SUPERSSN = '888666555' WHERE SSN = 67891234;
UPDATE EMPLOYEE SET SUPERSSN = '56789012' WHERE SSN = 89012345;
UPDATE EMPLOYEE SET SUPERSSN = '33344555' WHERE SSN = 123456789;
UPDATE EMPLOYEE SET SUPERSSN = '23456781' WHERE SSN = 888666555;
UPDATE DEPARTMENT SET MGRSSN = '888666555' WHERE DNO = 1;
UPDATE DEPARTMENT SET MGRSSN = '123456789' WHERE DNO = 4;
UPDATE DEPARTMENT SET MGRSSN = '33344555' WHERE DNO = 5;


INSERT INTO DLOCATION (DNO, DLOC) VALUES ('1', 'WASHINGTON');
INSERT INTO DLOCATION (DNO, DLOC) VALUES ('4', 'CALIFORNIA');
INSERT INTO DLOCATION (DNO, DLOC) VALUES ('5', 'NEW YORK');
INSERT INTO DLOCATION (DNO, DLOC) VALUES ('5', 'WASHINGTON');


INSERT INTO PROJECT (PNAME, PNO, PLOCATION, DNO) VALUES ('PRODUCTA',1,'HOUSTON', 5);
INSERT INTO PROJECT (PNAME, PNO, PLOCATION, DNO) VALUES('PRODUCTB', 2, 'WASHINGTON', 5);
INSERT INTO PROJECT (PNAME, PNO, PLOCATION, DNO) VALUES('PRODUCTC', 3, 'CALIFORNIA', 5);
INSERT INTO PROJECT (PNAME, PNO, PLOCATION, DNO) VALUES('COMPUTERIZATION',10,'NEW YORK',4);
INSERT INTO PROJECT (PNAME, PNO, PLOCATION, DNO) VALUES('IOT',20,'PARIS',1);
INSERT INTO PROJECT (PNAME, PNO, PLOCATION, DNO) VALUES('REORGANIZATION',30,'STAFFORD',4);


INSERT INTO WORKS_ON (SSN, PNO, HOURS) VALUES ('123456789', '1', '33');
INSERT INTO WORKS_ON (SSN, PNO, HOURS) VALUES ('984600445', '1', '50');
INSERT INTO WORKS_ON (SSN, PNO, HOURS) VALUES ('888666555', '2', '54');
INSERT INTO WORKS_ON (SSN, PNO, HOURS) VALUES ('33344555', '20', '10');
INSERT INTO WORKS_ON (SSN, PNO, HOURS) VALUES ('67891234', '10', '20');
INSERT INTO WORKS_ON (SSN, PNO, HOURS) VALUES ('23412356', '20', '14');
INSERT INTO WORKS_ON (SSN, PNO, HOURS) VALUES ('23456781', '1', '34');
INSERT INTO WORKS_ON (SSN, PNO, HOURS) VALUES ('1111111', '1', '33');
INSERT INTO WORKS_ON (SSN, PNO, HOURS) VALUES ('1111111', '2', '33');
INSERT INTO WORKS_ON (SSN, PNO, HOURS) VALUES ('1111111', '3', '33');

--QUERIES

--QUERY1
SELECT DISTINCT P.PNO
FROM PROJECT P, DEPARTMENT D, EMPLOYEE E
WHERE P.DNO=D.DNO AND D.MGRSSN=E.SSN
AND NAME="JENNIFER" -- "SCOTT"
UNION
SELECT DISTINCT P.PNO
FROM PROJECT P, WORKS_ON W, EMPLOYEE E
WHERE W.PNO=P.PNO AND W.SSN=E.SSN
AND NAME="JENNIFER"; -- "SCOTT"


--QUERY2
SELECT E.SSN, NAME, 1.1*SALARY AS NEW_SALARY
FROM EMPLOYEE E, PROJECT P, WORKS_ON W
WHERE E.SSN=W.SSN
AND P.PNO=W.PNO
AND P.PNAME="IOT";


--QUERY3
SELECT SUM(SALARY) AS SUM,
MAX(SALARY) AS MAX,
MIN(SALARY) AS MIN,
AVG(SALARY) AS AVG
FROM EMPLOYEE E, DEPARTMENT D
WHERE E.DNO=D.DNO
AND D.DNAME="IT";

--OR

SELECT SUM(SALARY) AS SUM,
MAX(SALARY) AS MAX,
MIN(SALARY) AS MIN,
AVG(SALARY) AS AVG
FROM EMPLOYEE NATURAL JOIN DEPARTMENT
WHERE DNAME="IT";


--QUERY4
SELECT E.NAME
FROM EMPLOYEE E
WHERE NOT EXISTS
(SELECT PNO
FROM PROJECT P, DEPARTMENT D
WHERE P.DNO=D.DNO AND D.DNO=5
AND PNO NOT IN
(SELECT PNO
FROM EMPLOYEE E1, WORKS_ON W
WHERE E1.SSN=W.SSN AND E1.SSN=E.SSN));


--QUERY5
SELECT D.DNO, COUNT(*) AS NUM_EMP_SALARY_ABOVE_6L
FROM DEPARTMENT D, EMPLOYEE E
WHERE D.DNO=E.DNO AND E.SALARY > 600000
AND E.DNO IN
(SELECT DNO
FROM EMPLOYEE
GROUP BY DNO
HAVING COUNT(*) > 5)
GROUP BY D.DNO;

--OR

SELECT DNO, COUNT(*) AS NUM_EMP_SALARY_ABOVE_6L
FROM EMPLOYEE NATURAL JOIN DEPARTMENT
WHERE SALARY > 600000
AND DNO IN
(SELECT DNO
FROM EMPLOYEE
GROUP BY DNO
HAVING COUNT(*) > 5)
GROUP BY DNO;