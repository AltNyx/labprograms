-- TABLES

CREATE TABLE ACTOR(
ACTOR_ID INT,
ACTOR_NAME VARCHAR(20),
ACTOR_GENDER CHAR(1),
PRIMARY KEY(ACTOR_ID));


CREATE TABLE DIRECTOR(
DIR_ID INT,
DIR_NAME VARCHAR(20),
DIR_PHONE INT,
PRIMARY KEY(DIR_ID));


CREATE TABLE MOVIES(
MOVIE_ID INT PRIMARY KEY,
MOVIE_TITLE VARCHAR(50),
MOVIE_YEAR INT NOT NULL,
MOVIE_LANG VARCHAR(20),
DIR_ID INT,
FOREIGN KEY(DIR_ID) REFERENCES DIRECTOR(DIR_ID) ON DELETE CASCADE);


CREATE TABLE MOVIE_CAST(
ACTOR_ID INT,
MOVIE_ID INT,
ROLE VARCHAR(50),
PRIMARY KEY(ACTOR_ID, MOVIE_ID),
FOREIGN KEY(ACTOR_ID) REFERENCES ACTOR(ACTOR_ID) ON DELETE CASCADE,
FOREIGN KEY(MOVIE_ID) REFERENCES MOVIES(MOVIE_ID) ON DELETE CASCADE);


CREATE TABLE RATING(
MOVIE_ID INT PRIMARY KEY,
REV_STARS INT NOT NULL,
FOREIGN KEY(MOVIE_ID) REFERENCES MOVIES(MOVIE_ID) ON DELETE CASCADE);


-- INSERTING

INSERT INTO ACTOR VALUES('101','JAMES','M');
INSERT INTO ACTOR VALUES('102','DEBORAH','F');        
INSERT INTO ACTOR VALUES('103','PETER','M');
INSERT INTO ACTOR VALUES('104','ROBERT','M');
INSERT INTO ACTOR VALUES('105','MURRAY','M');
INSERT INTO ACTOR VALUES('106','HARRISON','M');       
INSERT INTO ACTOR VALUES('107','NICOLE','F');
INSERT INTO ACTOR VALUES('108','STEPHEN','M');        
INSERT INTO ACTOR VALUES('109','JACK','M');
INSERT INTO ACTOR VALUES('110','KATE','F');

INSERT INTO DIRECTOR VALUES('201','ALFRED','675409'); 
INSERT INTO DIRECTOR VALUES('202','JACK','689543');   
INSERT INTO DIRECTOR VALUES('203','DAVID','660908');  
INSERT INTO DIRECTOR VALUES('204','MICHAEL','656432');
INSERT INTO DIRECTOR VALUES('205','MILOS','600944');
INSERT INTO DIRECTOR VALUES('206','STANLEY','677543');
INSERT INTO DIRECTOR VALUES('207','ROMAN','660089');

INSERT INTO MOVIES VALUES('1','VERTIGO','1994','ENGLISH','201');
INSERT INTO MOVIES VALUES('2','INNOCENTS','1997','ENGLISH','201');
INSERT INTO MOVIES VALUES('3','DEER HUNTER','1972','ENGLISH','202');
INSERT INTO MOVIES VALUES('4','EYES WID SHUT','2002','ENGLISH','202');
INSERT INTO MOVIES VALUES('5','WINGS','2016','ENGLISH','203');
INSERT INTO MOVIES VALUES('6','USUAL SUSPECTS','2006','ENGLISH','204');
INSERT INTO MOVIES VALUES('7','SAMURAI','2017','ENGLISH','205');
INSERT INTO MOVIES VALUES('8','THE PRESTIGE','2016','ENGLISH','206');
INSERT INTO MOVIES VALUES('9','AMERICAN BEAUTY','2015','ENGLISH','201');
INSERT INTO MOVIES VALUES('10','WALLS','2000','ENGLISH','207');

INSERT INTO MOVIE_CAST VALUES('101','1','JAMES');
INSERT INTO MOVIE_CAST VALUES('101','6','FERO');
INSERT INTO MOVIE_CAST VALUES('101','2','EDDIE');
INSERT INTO MOVIE_CAST VALUES('102','5','JULY');
INSERT INTO MOVIE_CAST VALUES('103','3','JOHN');
INSERT INTO MOVIE_CAST VALUES('104','7','ADAM');
INSERT INTO MOVIE_CAST VALUES('105','8','MANUS');
INSERT INTO MOVIE_CAST VALUES('106','1','RICK');
INSERT INTO MOVIE_CAST VALUES('107','8','ROSE');
INSERT INTO MOVIE_CAST VALUES('107','9','SAM');
INSERT INTO MOVIE_CAST VALUES('108','1','ROCK');
INSERT INTO MOVIE_CAST VALUES('108','5','BOBBY');
INSERT INTO MOVIE_CAST VALUES('109','10','ED');
INSERT INTO MOVIE_CAST VALUES('110','4','CATHIE');

INSERT INTO RATING VALUES('1','3');
INSERT INTO RATING VALUES('2','3');
INSERT INTO RATING VALUES('3','2');
INSERT INTO RATING VALUES('4','5');
INSERT INTO RATING VALUES('5','4');
INSERT INTO RATING VALUES('6','3');
INSERT INTO RATING VALUES('7','2');
INSERT INTO RATING VALUES('8','1');
INSERT INTO RATING VALUES('9','5');
INSERT INTO RATING VALUES('10','4');


-- QUERIES

--1
SELECT MOVIE_TITLE
FROM MOVIES
NATURAL JOIN DIRECTOR
WHERE DIR_NAME='ALFRED'; --'HITCHCOCK'

--OR
SELECT MOVIE_TITLE
FROM MOVIES
WHERE DIR_ID IN (SELECT DIR_ID
FROM DIRECTOR
WHERE DIR_NAME='ALFRED'); --'HITCHCOCK'

--OR
SELECT MOVIE_TITLE
FROM MOVIES M, DIRECTOR D
WHERE M.DIR_ID=D.DIR_ID AND DIR_NAME='ALFRED'; --'HITCHCOCK'


--2
SELECT MOVIE_TITLE
FROM MOVIES
WHERE MOVIE_ID IN (SELECT MOVIE_ID
FROM MOVIE_CAST
WHERE ACTOR_ID IN (SELECT ACTOR_ID
FROM MOVIE_CAST
GROUP BY ACTOR_ID
HAVING COUNT(*) > 1));


--3
SELECT ACTOR_NAME
FROM ACTOR
WHERE ACTOR_ID IN (SELECT A.ACTOR_ID
FROM (SELECT ACTOR_ID
FROM MOVIE_CAST MC JOIN MOVIES M
ON M.MOVIE_ID=MC.MOVIE_ID
WHERE MOVIE_YEAR < 2000) A,
(SELECT ACTOR_ID
FROM MOVIE_CAST MC JOIN MOVIES M
ON M.MOVIE_ID=MC.MOVIE_ID
WHERE MOVIE_YEAR > 2015) B
WHERE A.ACTOR_ID=B.ACTOR_ID);

--OR
CREATE VIEW V1 AS
SELECT ACTOR_NAME
FROM ACTOR
NATURAL JOIN MOVIE_CAST
NATURAL JOIN MOVIES
WHERE MOVIE_YEAR < 2000;


CREATE VIEW V2 AS
SELECT ACTOR_NAME
FROM ACTOR
NATURAL JOIN MOVIE_CAST
NATURAL JOIN MOVIES
WHERE MOVIE_YEAR > 2015;

SELECT * FROM V1 NATURAL JOIN V2;


--4 (IF ONLY ONE RATING PER MOVIE)
SELECT MOVIE_TITLE, REV_STARS
FROM MOVIES NATURAL JOIN RATING
ORDER BY MOVIE_TITLE;


--OR (IF MULTIPLE RATINGS PER MOVIE)
SELECT MOVIE_TITLE, MAX(REV_STARS)
FROM MOVIES
NATURAL JOIN RATING
GROUP BY MOVIE_TITLE
HAVING MAX(REV_STARS) > 0
ORDER BY MOVIE_TITLE;


--5
UPDATE RATING
SET REV_STARS=5
WHERE MOVIE_ID IN (SELECT M.MOVIE_ID
FROM MOVIES M, DIRECTOR D
WHERE M.DIR_ID=D.DIR_ID
AND DIR_NAME='MICHAEL'); --'STEVEN SPIELBERG'

SELECT * FROM RATING;

--OR
UPDATE RATING
NATURAL JOIN MOVIES
NATURAL JOIN DIRECTOR
SET REV_STARS=5
WHERE DIR_NAME='MICHAEL'; --'STEVEN SPIELBERG'

SELECT * FROM RATING;