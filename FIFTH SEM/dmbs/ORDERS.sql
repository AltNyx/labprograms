-- TABLES

CREATE TABLE SALESMAN(
SALESMAN_ID VARCHAR(10),
NAME VARCHAR(20) NOT NULL,
CITY VARCHAR(20),
COMMISSION VARCHAR(10),
PRIMARY KEY(SALESMAN_ID));


CREATE TABLE CUSTOMER(
CUSTOMER_ID VARCHAR(10) PRIMARY KEY,
CUST_NAME VARCHAR(20) NOT NULL,
CITY VARCHAR(20),
GRADE INT,
SALESMAN_ID VARCHAR(10),
FOREIGN KEY(SALESMAN_ID) REFERENCES SALESMAN(SALESMAN_ID) ON DELETE CASCADE);


CREATE TABLE ORDERS(
ORD_NO VARCHAR(10) PRIMARY KEY,
AMOUNT INT NOT NULL,
ORD_DATE DATE,
SALESMAN_ID VARCHAR(10),
CUSTOMER_ID VARCHAR(10),
FOREIGN KEY(SALESMAN_ID) REFERENCES SALESMAN(SALESMAN_ID) ON DELETE CASCADE,
FOREIGN KEY(CUSTOMER_ID) REFERENCES CUSTOMER(CUSTOMER_ID) ON DELETE CASCADE);




INSERT INTO SALESMAN VALUES('S1','AMIR','BANGALORE','10%');     
INSERT INTO SALESMAN VALUES('S2','DANIEL','MYSORE','20%');      
INSERT INTO SALESMAN VALUES('S3','THOMAS','MUMBAI','30%');      
INSERT INTO SALESMAN VALUES('S4','RAGHU','PUNE','40%');
INSERT INTO SALESMAN VALUES('S5','RAM','PATNA','50%');
INSERT INTO SALESMAN VALUES('S6','RAJA','GOA','15%');
INSERT INTO SALESMAN VALUES('S7','WADIA','LUCKNOW','5%');       


INSERT INTO CUSTOMER VALUES('C1','ATHIRA','BANGALORE',100,'S1');
INSERT INTO CUSTOMER VALUES('C2','BARKHA','MYSORE',200,'S2');   
INSERT INTO CUSTOMER VALUES('C3','TRIPTHI','MUMBAI',300,'S3');  
INSERT INTO CUSTOMER VALUES('C4','DIA','PUNE',400,'S4');        
INSERT INTO CUSTOMER VALUES('C5','DEEPU','PATNA',500,'S5');
INSERT INTO CUSTOMER VALUES('C6','ELIZA','BANGALORE',100,'S1');
INSERT INTO CUSTOMER VALUES('C7','CLARA','BANGALORE',200,'S2');
INSERT INTO CUSTOMER VALUES('C8','DEENA','MYSORE',300,'S2');
INSERT INTO CUSTOMER VALUES('C9','HEENA','MUMBAI',400,'S3');
INSERT INTO CUSTOMER VALUES('C10','PRABHAS','MUMBAI',500,'S4');
INSERT INTO CUSTOMER VALUES('C11','BALA','CHENNAI',200,'S5');
INSERT INTO CUSTOMER VALUES('C12','CHANDRA','HYDERABAD',300,'S1');
INSERT INTO CUSTOMER VALUES('C13','SUSAN','TRIVADURM',400,'S2');
INSERT INTO CUSTOMER VALUES('C14','PRIYA','GOA',500,'S3');
INSERT INTO CUSTOMER VALUES('C15','RIYA','UDUPI',100,'S4');
INSERT INTO CUSTOMER VALUES('C16','MEGHA','BANAGLORE',100,'S5');


INSERT INTO ORDERS VALUES('O1',1000,'2017-08-01','S1','C1');
INSERT INTO ORDERS VALUES('O2',2000,'2017-08-02','S2','C2');
INSERT INTO ORDERS VALUES('O3',3000,'2017-08-03','S3','C3');
INSERT INTO ORDERS VALUES('O4',4000,'2017-08-04','S4','C4');
INSERT INTO ORDERS VALUES('O5',5000,'2017-08-05','S5','C5');
INSERT INTO ORDERS VALUES('O6',6000,'2017-08-01','S1','C6');
INSERT INTO ORDERS VALUES('O7',7000,'2017-08-06','S2','C7');
INSERT INTO ORDERS VALUES('O8',8000,'2017-08-06','S3','C8');
INSERT INTO ORDERS VALUES('O9',9000,'2017-08-07','S4','C9');
INSERT INTO ORDERS VALUES('O10',10000,'2013-08-08','S5','C10');
INSERT INTO ORDERS VALUES('O11',1500,'2017-08-01','S1','C11');
INSERT INTO ORDERS VALUES('O12',2500,'2017-06-01','S2','C12');
INSERT INTO ORDERS VALUES('O13',3500,'2017-03-01','S3','C13');
INSERT INTO ORDERS VALUES('O14',4500,'2017-02-01','S4','C14');
INSERT INTO ORDERS VALUES('O15',5500,'2017-01-01','S5','C15');
INSERT INTO ORDERS VALUES('O16',6500,'2017-05-01','S6','C16');


SELECT COUNT(CUSTOMER_ID)
FROM CUSTOMER
WHERE GRADE > (SELECT AVG(GRADE)
FROM CUSTOMER
WHERE CITY='BANGALORE');

SELECT S.SALESMAN_ID, S.NAME, COUNT(*) AS NUM_CUSTOMERS
FROM SALESMAN S, CUSTOMER C
WHERE S.SALESMAN_ID=C.SALESMAN_ID
GROUP BY S.SALESMAN_ID
HAVING COUNT(*) > 1;

SELECT DISTINCT S.SALESMAN_ID, C.CUSTOMER_ID, "SAME CITY" AS CUSTOMER_IN
FROM SALESMAN S, CUSTOMER C
WHERE S.SALESMAN_ID=C.SALESMAN_ID AND S.CITY=C.CITY
UNION
SELECT DISTINCT S.SALESMAN_ID, C.CUSTOMER_ID, "DIFF CITY" AS CUSTOMER_IN
FROM SALESMAN S, CUSTOMER C
WHERE S.SALESMAN_ID=C.SALESMAN_ID AND S.CITY!=C.CITY;


CREATE VIEW HIGHEST_ORDERS AS
SELECT O1.ORD_DATE, S.SALESMAN_ID, S.NAME, O1.CUSTOMER_ID, O1.ORD_NO
FROM SALESMAN S, ORDERS O1
WHERE S.SALESMAN_ID=O1.SALESMAN_ID
AND AMOUNT = (SELECT MAX(AMOUNT)
FROM ORDERS O2
WHERE O1.ORD_DATE=O2.ORD_DATE);

SELECT * FROM HIGHEST_ORDERS;



DELETE FROM SALESMAN WHERE SALESMAN_ID='S6';

SELECT * FROM SALESMAN;